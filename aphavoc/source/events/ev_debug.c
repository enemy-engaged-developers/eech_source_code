//
// 	 Enemy Engaged RAH-66 Comanche Versus KA-52 Hokum
// 	 Copyright (C) 2000 Empire Interactive (Europe) Ltd,
// 	 677 High Road, North Finchley, London N12 0DA
//
// 	 Please see the document LICENSE.TXT for the full licence agreement
//
// 2. LICENCE
//  2.1
//  	Subject to the provisions of this Agreement we now grant to you the
//  	following rights in respect of the Source Code:
//   2.1.1
//   	the non-exclusive right to Exploit  the Source Code and Executable
//   	Code on any medium; and
//   2.1.2
//   	the non-exclusive right to create and distribute Derivative Works.
//  2.2
//  	Subject to the provisions of this Agreement we now grant you the
// 	following rights in respect of the Object Code:
//   2.2.1
// 	the non-exclusive right to Exploit the Object Code on the same
// 	terms and conditions set out in clause 3, provided that any
// 	distribution is done so on the terms of this Agreement and is
// 	accompanied by the Source Code and Executable Code (as
// 	applicable).
//
// 3. GENERAL OBLIGATIONS
//  3.1
//  	In consideration of the licence granted in clause 2.1 you now agree:
//   3.1.1
// 	that when you distribute the Source Code or Executable Code or
// 	any Derivative Works to Recipients you will also include the
// 	terms of this Agreement;
//   3.1.2
// 	that when you make the Source Code, Executable Code or any
// 	Derivative Works ("Materials") available to download, you will
// 	ensure that Recipients must accept the terms of this Agreement
// 	before being allowed to download such Materials;
//   3.1.3
// 	that by Exploiting the Source Code or Executable Code you may
// 	not impose any further restrictions on a Recipient's subsequent
// 	Exploitation of the Source Code or Executable Code other than
// 	those contained in the terms and conditions of this Agreement;
//   3.1.4
// 	not (and not to allow any third party) to profit or make any
// 	charge for the Source Code, or Executable Code, any
// 	Exploitation of the Source Code or Executable Code, or for any
// 	Derivative Works;
//   3.1.5
// 	not to place any restrictions on the operability of the Source
// 	Code;
//   3.1.6
// 	to attach prominent notices to any Derivative Works stating
// 	that you have changed the Source Code or Executable Code and to
// 	include the details anddate of such change; and
//   3.1.7
//   	not to Exploit the Source Code or Executable Code otherwise than
// 	as expressly permitted by  this Agreement.
//



/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "project.h"

#include "ai/ai_misc/ai_route.h"
#include "ai/taskgen/assign.h"
#include "ai/taskgen/engage.h"
#include "ai/taskgen/taskgen.h"
#include "ai/highlevl/imaps.h"
#include "gunships/dynamics/common/co_undercarriage.h"

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// DISPLAY INFO EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_debug_misc_info_event (event *ev)
{
	in_flight_debug_misc_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_external_view_entity_debug_flight_info_event (event *ev)
{
	in_flight_external_view_entity_debug_flight_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_debug_keysite_info_event (event *ev)
{
	in_flight_debug_keysite_info = ( in_flight_debug_keysite_info + 1 ) % (NUM_ENTITY_SUB_TYPE_LANDINGS + 1);

	//dump_keysite_info ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_debug_force_info_event (event *ev)
{
	in_flight_debug_force_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_external_view_entity_debug_task_info_event (event *ev)
{
	in_flight_external_view_entity_debug_task_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_external_view_entity_guide_info_event (event *ev)
{
	in_flight_external_view_entity_guide_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_gunship_target_list_info_event (event *ev)
{
	in_flight_gunship_target_list_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// WEAPON EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_external_view_entity_weapon_info_event (event *ev)
{
	in_flight_external_view_entity_weapon_info ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_infinite_weapons_event (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		if (get_local_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_WEAPONS))
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_WEAPONS, FALSE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Disable infinite weapons");
		}
		else
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_WEAPONS, TRUE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Enable infinite weapons");
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_weapon_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		launch_client_server_weapon (en, get_local_entity_int_value (en, INT_TYPE_SELECTED_WEAPON), FALSE);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_chaff_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		launch_client_server_weapon (en, ENTITY_SUB_TYPE_WEAPON_CHAFF, FALSE);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_flare_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		launch_client_server_weapon (en, ENTITY_SUB_TYPE_WEAPON_FLARE, FALSE);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_smoke_grenade_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		launch_client_server_weapon (en, ENTITY_SUB_TYPE_WEAPON_SMOKE_GRENADE, FALSE);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_crate_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		launch_client_server_weapon (en, ENTITY_SUB_TYPE_WEAPON_CRATE, FALSE);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void launch_persuer_weapon_event (event *ev)
{
	entity
		*en,
		*persuer;

	entity_sub_types
		weapon_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		persuer = get_local_entity_first_child (en, LIST_TYPE_TARGET);

		while (persuer)
		{
			if (get_local_entity_int_value (persuer, INT_TYPE_IDENTIFY_MOBILE))
			{
				weapon_type = get_best_weapon_for_target (persuer, en, BEST_WEAPON_CRITERIA_ALL);

				if (weapon_type != get_local_entity_int_value (persuer, INT_TYPE_SELECTED_WEAPON))
				{
					set_client_server_entity_int_value (persuer, INT_TYPE_SELECTED_WEAPON, weapon_type);
				}

				if (weapon_type != ENTITY_SUB_TYPE_WEAPON_NO_WEAPON)
				{
					launch_client_server_weapon (persuer, weapon_type, FALSE);
				}
			}

			persuer = get_local_entity_child_succ (persuer, LIST_TYPE_TARGET);
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void select_next_weapon_event (event *ev)
{
	entity
		*en;

	entity_sub_types
		weapon_sub_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		weapon_sub_type = get_next_available_weapon_sub_type (en);

		if (en == get_gunship_entity ())
		{
			set_gunship_weapon (weapon_sub_type);
		}
		else
		{
			if (weapon_sub_type != get_local_entity_int_value (en, INT_TYPE_SELECTED_WEAPON))
			{
				set_client_server_entity_int_value (en, INT_TYPE_SELECTED_WEAPON, weapon_sub_type);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void select_previous_weapon_event (event *ev)
{
	entity
		*en;

	entity_sub_types
		weapon_sub_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		weapon_sub_type = get_previous_available_weapon_sub_type (en);

		if (en == get_gunship_entity ())
		{
			set_gunship_weapon (weapon_sub_type);
		}
		else
		{
			if (weapon_sub_type != get_local_entity_int_value (en, INT_TYPE_SELECTED_WEAPON))
			{
				set_client_server_entity_int_value (en, INT_TYPE_SELECTED_WEAPON, weapon_sub_type);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void select_invalid_weapon_event (event *ev)
{
	entity
		*en;

	entity_sub_types
		weapon_sub_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		weapon_sub_type = ENTITY_SUB_TYPE_WEAPON_NO_WEAPON;

		if (en == get_gunship_entity ())
		{
			set_gunship_weapon (weapon_sub_type);
		}
		else
		{
			if (weapon_sub_type != get_local_entity_int_value (en, INT_TYPE_SELECTED_WEAPON))
			{
				set_client_server_entity_int_value (en, INT_TYPE_SELECTED_WEAPON, weapon_sub_type);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void increase_drag_z_event(event *ev)
{
	if (current_flight_dynamics)
		current_flight_dynamics->drag_z.modifier += 0.05;
	
	debug_log("drag_z %f", current_flight_dynamics->drag_z.modifier);
}

static void decrease_drag_z_event(event *ev)
{
	if (current_flight_dynamics)
		current_flight_dynamics->drag_z.modifier -= 0.05;

	debug_log("drag_z %f", current_flight_dynamics->drag_z.modifier);
}

static void select_next_weapon_config_event (event *ev)
{
	entity
		*en;

	weapon_config_types
		config_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE);

		if (config_type == WEAPON_CONFIG_TYPE_UNARMED)
		{
			config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_MAX_WEAPON_CONFIG_TYPE);
		}
		else
		{
			config_type = (weapon_config_types) ((int) config_type + 1);

			if (config_type > get_local_entity_int_value (en, INT_TYPE_MAX_WEAPON_CONFIG_TYPE))
			{
				config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_MIN_WEAPON_CONFIG_TYPE);
			}
		}

		set_client_server_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE, config_type);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void select_previous_weapon_config_event (event *ev)
{
	entity
		*en;

	weapon_config_types
		config_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE);

		if (config_type == WEAPON_CONFIG_TYPE_UNARMED)
		{
			config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_MIN_WEAPON_CONFIG_TYPE);
		}
		else
		{
			config_type = (weapon_config_types) ((int) config_type - 1);

			if (config_type < get_local_entity_int_value (en, INT_TYPE_MIN_WEAPON_CONFIG_TYPE))
			{
				config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_MAX_WEAPON_CONFIG_TYPE);
			}
		}

		set_client_server_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE, config_type);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void reload_weapon_config_event (event *ev)
{
	entity
		*en;

	weapon_config_types
		config_type;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE);

		if (config_type == WEAPON_CONFIG_TYPE_UNARMED)
		{
			config_type = (weapon_config_types) get_local_entity_int_value (en, INT_TYPE_DEFAULT_WEAPON_CONFIG_TYPE);
		}

		set_client_server_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE, config_type);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void unarm_weapon_config_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		set_client_server_entity_int_value (en, INT_TYPE_WEAPON_CONFIG_TYPE, WEAPON_CONFIG_TYPE_UNARMED);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// AVIONICS EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void cycle_cpg_assistance_event (event *ev)
{
	switch (get_global_cpg_assist_type ())
	{
		////////////////////////////////////////
		case CPG_ASSIST_TYPE_NONE:
		////////////////////////////////////////
		{
			set_global_cpg_assist_type (CPG_ASSIST_TYPE_EASY);

			break;
		}
		////////////////////////////////////////
		case CPG_ASSIST_TYPE_EASY:
		////////////////////////////////////////
		{
			set_global_cpg_assist_type (CPG_ASSIST_TYPE_REAL);

			break;
		}
		////////////////////////////////////////
		case CPG_ASSIST_TYPE_REAL:
		////////////////////////////////////////
		{
			set_global_cpg_assist_type (CPG_ASSIST_TYPE_NONE);

			break;
		}
		////////////////////////////////////////
		default:
		////////////////////////////////////////
		{
			debug_fatal ("Invalid cpg assist type = %d", get_global_cpg_assist_type ());

			break;
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_hud_layout_grid_event (event *ev)
{
	display_hud_layout_grid ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_mfd_layout_grid_event (event *ev)
{
	display_mfd_layout_grid ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_test_cockpit_instruments_event (event *ev)
{
	test_cockpit_instruments ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_virtual_cockpit_needles_event (event *ev)
{
	draw_virtual_cockpit_needles_on_fixed_cockpits ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#if 0
static void light_damage_gunship_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		damage_client_server_entity_avionics (en, GUNSHIP_DAMAGE_LEVEL_LIGHT);
	}
}
#endif

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void medium_damage_gunship_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		damage_client_server_entity_avionics (en, GUNSHIP_DAMAGE_LEVEL_MEDIUM);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void heavy_damage_gunship_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		damage_client_server_entity_avionics (en, GUNSHIP_DAMAGE_LEVEL_HEAVY);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void partially_repair_gunship_damage_event (event *ev)
{
	partially_repair_gunship_damage ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void fully_repair_gunship_damage_event (event *ev)
{
	fully_repair_gunship_damage ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_night_vision_system_active_event (event *ev)
{
	night_vision_system_active ^= 1;

	debug_log ("night_vision_system_active = %d", night_vision_system_active);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_simple_avionics_event (event *ev)
{
	if (get_global_avionics_realism_level () < AVIONICS_REALISM_LEVEL_REALISTIC)
		set_global_avionics_realism_level (get_global_avionics_realism_level () + 1);
	else 
		set_global_avionics_realism_level (AVIONICS_REALISM_LEVEL_SIMPLE);

	debug_colour_log (DEBUG_COLOUR_AMBER, "simple_avionics = %d", get_global_avionics_realism_level ());
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// SESSION EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void cycle_weather_modes_event (event *ev)
{
	weathermodes
		target_weather_mode;

	ASSERT (get_session_entity ());

	set_local_entity_int_value (get_session_entity (), INT_TYPE_LOCAL_WEATHER_MODEL, FALSE);

	switch (get_local_entity_int_value (get_session_entity (), INT_TYPE_WEATHER_MODE))
	{
		case WEATHERMODE_DRY:
		{
			target_weather_mode = WEATHERMODE_LIGHT_RAIN;

			debug_log ("Weather mode set to light rain");

			break;
		}
		case WEATHERMODE_LIGHT_RAIN:
		{
			target_weather_mode = WEATHERMODE_HEAVY_RAIN;

			debug_log ("Weather mode set to heavy rain");

			break;
		}
		case WEATHERMODE_HEAVY_RAIN:
		{
			target_weather_mode = WEATHERMODE_SNOW;

			debug_log ("Weather mode set to snow");

			break;
		}
		case WEATHERMODE_SNOW:
		{
			target_weather_mode = WEATHERMODE_DRY;

			debug_log ("Weather mode set to dry");

			break;
		}
	}

	set_local_entity_int_value (get_session_entity (), INT_TYPE_TARGET_WEATHER_MODE, target_weather_mode);

	set_local_entity_float_value (get_session_entity (), FLOAT_TYPE_WEATHER_MODE_TRANSITIONAL_PERIOD, 2.0);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_fine_weather_mode_event (event *ev)
{
	ASSERT (get_session_entity ());

	set_local_entity_int_value (get_session_entity (), INT_TYPE_LOCAL_WEATHER_MODEL, FALSE);

	debug_log ("Weather mode set to dry");

	set_local_entity_int_value (get_session_entity (), INT_TYPE_TARGET_WEATHER_MODE, WEATHERMODE_DRY);

	set_local_entity_float_value (get_session_entity (), FLOAT_TYPE_WEATHER_MODE_TRANSITIONAL_PERIOD, 2.0);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_local_weather_model_event (event *ev)
{
	int
		state;

	state = get_local_entity_int_value (get_session_entity (), INT_TYPE_LOCAL_WEATHER_MODEL);

	set_local_entity_int_value (get_session_entity (), INT_TYPE_LOCAL_WEATHER_MODEL, !state);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void increase_session_time_of_day_acceleration (event *ev)
{
	float
		accel;

	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		accel = get_local_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION);

		if (accel == 1.0)
		{
			set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 60.0 * 10.0);

			debug_log ("Set session time of day acceleration to MIN");
		}
		else if (accel == 60.0 * 10.0)
		{
			set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 60.0 * 30.0);

			debug_log ("Set session time of day acceleration to MED");
		}
		else if (accel == 60.0 * 30.0)
		{
			set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 60.0 * 60.0);

			debug_log ("Set session time of day acceleration to MAX");
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void reset_session_time_of_day_acceleration (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 1.0);

		set_client_server_entity_int_value (get_session_entity (), INT_TYPE_SKIP_NIGHT_TIME, FALSE);

		debug_log ("Reset session time of day acceleration");
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_demo_time_of_day_acceleration (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 60.0 * 2.5);

		set_client_server_entity_int_value (get_session_entity (), INT_TYPE_SKIP_NIGHT_TIME, TRUE);

		debug_log ("Set session time of day acceleration to MIN and skip night-time");
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_gunship_entity_to_null_event (event *ev)
{
	set_gunship_entity (NULL);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_infinite_fuel_event (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		if (get_local_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_FUEL))
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_FUEL, FALSE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Disable infinite fuel");
		}
		else
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_FUEL, TRUE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Enable infinite fuel");
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_suppress_ai_fire_event (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		if (get_local_entity_int_value (get_session_entity (), INT_TYPE_SUPPRESS_AI_FIRE))
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_SUPPRESS_AI_FIRE, FALSE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Disable suppress AI fire");
		}
		else
		{
			set_client_server_entity_int_value (get_session_entity (), INT_TYPE_SUPPRESS_AI_FIRE, TRUE);

			debug_colour_log (DEBUG_COLOUR_AMBER, "Enable suppress AI fire");
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_invulnerable_event (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{

		int
			current_inv;

		// states :-
		// 0 -> invulnerable from collisions
		// 1 -> invulnerable from weapons
		// 2 -> invulnerable from collisions and weapons
		// 3 -> invulnerable from nothing

		current_inv = 0;

		if (get_local_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_COLLISIONS))
		{

			current_inv += 1;
		}

		if (get_local_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_WEAPONS))
		{

			current_inv += 2;
		}

		switch (current_inv)
		{

			case 0:
			{

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_COLLISIONS, TRUE);

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_WEAPONS, FALSE);

				debug_colour_log (DEBUG_COLOUR_AMBER, "Invulnerable from COLLISIONS");

				break;
			}

			case 1:
			{

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_COLLISIONS, FALSE);

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_WEAPONS, TRUE);

				debug_colour_log (DEBUG_COLOUR_AMBER, "Invulnerable from WEAPONS");

				break;
			}

			case 2:
			{

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_COLLISIONS, TRUE);

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_WEAPONS, TRUE);

				debug_colour_log (DEBUG_COLOUR_AMBER, "Invulnerable from COLLISIONS and WEAPONS");

				break;
			}

			case 3:
			{

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_COLLISIONS, FALSE);

				set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INVULNERABLE_FROM_WEAPONS, FALSE);

				debug_colour_log (DEBUG_COLOUR_AMBER, "Disable invulnerable");

				break;
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_ai_invulnerable_event (event *ev)
{
	if (toggle_damage_debug_invulnerable_flag ())
	{
		debug_colour_log (DEBUG_COLOUR_AMBER, "Enable AI invulnerable");
	}
	else
	{
		debug_colour_log (DEBUG_COLOUR_AMBER, "Disable AI invulnerable");
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_entity_group_leader_event (event *ev)
{
	entity
		*en,
		*group;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if (en)
		{
			group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

			if (group)
			{
				set_client_server_entity_parent (en, LIST_TYPE_MEMBER, group);

				set_group_member_numbers (group);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// 3D VISUAL EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void clear_debug_3d_graphics_event (event *ev)
{
	destroy_all_debug_3d_objects ();

	destroy_all_debug_3d_lines ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_articulation_test_event (event *ev)
{
	in_flight_articulation_test ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_in_flight_zoom_test_event (event *ev)
{
	in_flight_zoom_test ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void save_screen_image_event (event *ev)
{
	save_screen_image_and_viewpoint_data ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void delete_screen_image_event (event *ev)
{
	delete_screen_image_and_viewpoint_data ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void save_hires_screen_image_event (event *ev)
{
	save_high_res_screen_image ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_hires_screen_image_view_angle_1_event (event *ev)
{
	set_high_res_screen_image_viewangle_1 ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_hires_screen_image_view_angle_2_event (event *ev)
{
	set_high_res_screen_image_viewangle_2 ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_hires_screen_image_view_angle_3_event (event *ev)
{
	set_high_res_screen_image_viewangle_3 ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_hires_screen_image_view_angle_4_event (event *ev)
{
	set_high_res_screen_image_viewangle_4 ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_record_screen_sequence_event (event *ev)
{
	if (record_screen_sequence)
	{
		unlock_frame_rate ();

		record_screen_sequence = FALSE;
	}
	else
	{
		lock_frame_rate (30.0);

		record_screen_sequence = TRUE;
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_gunship_object_event (event *ev)
{
	in_flight_invisible_object ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_draw_collision_boxes_event (event *ev)
{
	draw_collision_boxes ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_draw_collision_box_lifetime_event (event *ev)
{
	if (collision_box_lifetime == 0.0)
	{
		collision_box_lifetime = 2.0;
	}
	else
	{
		collision_box_lifetime = 0.0;
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_draw_radar_sweep_event (event *ev)
{
	draw_radar_sweep ^= 1;

	draw_eo_boresight ^= 1;

	draw_hms_field_of_view ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void toggle_draw_radar_terrain_los_markers_event (event *ev)
{
	draw_radar_terrain_los_markers ^= 1;

	draw_eo_terrain_los_markers ^= 1;

	draw_hms_terrain_los_markers ^= 1;

	draw_weapon_terrain_los_markers ^= 1;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void safe_view_event (event *ev)
{
   set_view_mode (VIEW_MODE_SAFE);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debriefing_event (event *ev)
{
	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_DEBRIEFING);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void recognition_guide_top_view_event (event *ev)
{
	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_RECOGNITION_GUIDE_TOP_VIEW);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void recognition_guide_side_view_event (event *ev)
{
	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_RECOGNITION_GUIDE_SIDE_VIEW);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void recognition_guide_front_view_event (event *ev)
{
	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_RECOGNITION_GUIDE_FRONT_VIEW);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void recognition_guide_3d_view_event (event *ev)
{
	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_RECOGNITION_GUIDE_3D_VIEW);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void transmit_external_view_entity_event (event *ev)
{
	entity
		*en;

	en = get_external_view_entity ();

	if (en)
	{
		//
		// make all connected machines display this machine's external view entity
		//

		transmit_entity_comms_message (ENTITY_COMMS_SET_EXTERNAL_VIEW_ENTITY, en);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//
// this is the same as the Left Alt-F6 key, however, that key only works full screen
//

static void view_wingmen_event (event *ev)
{
	if (select_view_menu_view_players_target ())
	{
		select_external_view ();
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// AI EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void kill_external_view_entity_event (event *ev)
{
	entity
		*en;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if ((en) && (get_local_entity_int_value (en, INT_TYPE_ALIVE)))
		{
			debug_colour_log (DEBUG_COLOUR_RED, "Killing external view entity!");

			set_client_server_entity_int_value (en, INT_TYPE_DAMAGE_LEVEL, 0);

			notify_local_entity (ENTITY_MESSAGE_COLLISION, en, NULL, 0.0);
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void damage_external_view_entity_event (event *ev)
{
	entity
		*en;

	int
		damage_level;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if ((en) && (get_local_entity_int_value (en, INT_TYPE_ALIVE)))
		{
			damage_level = get_local_entity_int_value (en, INT_TYPE_DAMAGE_LEVEL);

			damage_level = max (0, damage_level - 50);

			debug_colour_log (DEBUG_COLOUR_RED, "Damage external view entity! ( %d )", damage_level);

			set_client_server_entity_int_value (en, INT_TYPE_DAMAGE_LEVEL, damage_level);

			notify_local_entity (ENTITY_MESSAGE_COLLISION, en, NULL, 0.0);
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void damage_external_view_entity_main_rotors_event (event *ev)
{
	entity
		*en;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if ((en) && (get_local_entity_int_value (en, INT_TYPE_ALIVE)))
		{
			debug_colour_log (DEBUG_COLOUR_RED, "Damage external view entity main rotors");

			set_client_server_entity_int_value (en, INT_TYPE_MAIN_ROTOR_DAMAGED, TRUE);

			set_client_server_entity_int_value (en, INT_TYPE_TAIL_ROTOR_DAMAGED, TRUE);
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void restore_external_view_entity_main_rotors_event (event *ev)
{
	entity
		*en;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if ((en) && (get_local_entity_int_value (en, INT_TYPE_ALIVE)))
		{
			debug_colour_log (DEBUG_COLOUR_RED, "Restore external view entity main rotors");

			restore_helicopter_entity (en);

			transmit_entity_comms_message (ENTITY_COMMS_RESTORE_ENTITY, en, get_local_entity_vec3d_ptr (en, VEC3D_TYPE_POSITION), get_local_entity_int_value (en, INT_TYPE_OPERATIONAL_STATE));
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void create_dummy_task_event (event *ev)
{
	entity
		*en,
		*task,
		*last,
		*group,
		*keysite,
		*landing;

	if (get_comms_model () != COMMS_MODEL_SERVER) return;

	//
	// get external view entity and check it is an aircraft
	//

	en = get_external_view_entity ();

	if (!en) return;

	if (!get_local_entity_int_value (en, INT_TYPE_IDENTIFY_AIRCRAFT)) return;

	//
	// get group and check that it is currently idle
	//

	group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

	if (!group) return;

	if (get_local_entity_int_value (group, INT_TYPE_GROUP_MODE) != GROUP_MODE_IDLE) return;

	//
	// get keysite entity belongs to
	//

	keysite = get_local_entity_parent (group, LIST_TYPE_KEYSITE_GROUP);

	ASSERT (keysite);

	ASSERT (get_local_entity_type (keysite) == ENTITY_TYPE_KEYSITE);

	//
	// create CAP task and assign it to the group
	//

	task = create_cap_task ((entity_sides) get_local_entity_int_value (en, INT_TYPE_SIDE), keysite, NULL, TRUE, 10.0, 30.0 * ONE_MINUTE, NULL, NULL);

	if (!task) return;

	if (!assign_primary_task_to_group (group, task))
	{
		debug_log ("EV_DEBUG: created task but could not assign it to group %s", get_local_entity_string (group, STRING_TYPE_FULL_NAME));

		return;
	}

	//
	// see if group members have been put into the takeoff queue, and if so make them push in at the front (i.e. end of the list)
	//

	en = get_local_entity_first_child (group, LIST_TYPE_MEMBER);

	while (en)
	{
		landing = get_local_entity_parent (en, LIST_TYPE_TAKEOFF_QUEUE);

		if (landing)
		{
			//
			// find last entity in the queue (i.e. the first to takeoff)
			//

			last = get_local_entity_first_child (landing, LIST_TYPE_TAKEOFF_QUEUE);

			while (get_local_entity_child_succ (last, LIST_TYPE_TAKEOFF_QUEUE))
			{
				last = get_local_entity_child_succ (last, LIST_TYPE_TAKEOFF_QUEUE);
			}

			if (en != last)
			{
				delete_local_entity_from_parents_child_list (en, LIST_TYPE_TAKEOFF_QUEUE);

				insert_local_entity_into_parents_child_list (en, LIST_TYPE_TAKEOFF_QUEUE, landing, last);
			}
		}

		en = get_local_entity_child_succ (en, LIST_TYPE_MEMBER);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void create_debug_engage_task (int target_type)
{
	entity
		*en,
		*task,
		*guide,
		*group;

	vec3d
		*pos;

	if (get_comms_model () != COMMS_MODEL_SERVER)
	{
		return;
	}

	//
	// get external view entity and check it is an aircraft, and that it is not landed
	//

	en = get_external_view_entity ();

	if (!en)
	{
		return;
	}

	if (!get_local_entity_int_value (en, INT_TYPE_IDENTIFY_AIRCRAFT))
	{
		return;
	}

	if (get_local_entity_int_value (en, INT_TYPE_LANDED))
	{
		return;
	}

	group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

	if (!group)
	{
		return;
	}

	if (!get_local_entity_int_value (group, INT_TYPE_ENGAGE_ENEMY))
	{
		return;
	}

	//
	// check that the group is not already engaging
	//

	guide = get_local_entity_first_child (group, LIST_TYPE_GUIDE_STACK);

	while (guide)
	{
		task = get_local_entity_parent (guide, LIST_TYPE_GUIDE);

		ASSERT (task);

		if (get_local_entity_int_value (task, INT_TYPE_ENTITY_SUB_TYPE) == ENTITY_SUB_TYPE_TASK_ENGAGE)
		{
			return;
		}

		guide = get_local_entity_child_succ (guide, LIST_TYPE_GUIDE_STACK);
	}

	pos = get_local_entity_vec3d_ptr (en, VEC3D_TYPE_POSITION);

	debug_engage_targets_in_area (group, pos, 2500.0, target_type);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void create_ground_engage_task_event (event *ev)
{
	create_debug_engage_task (TARGET_TYPE_GROUND);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void create_air_engage_task_event (event *ev)
{
	create_debug_engage_task (TARGET_TYPE_AIR);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_entity_task_abort (event *ev)
{
	entity
		*en,
		*task,
		*guide;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if (en)
		{
			guide = get_local_entity_parent (en, LIST_TYPE_FOLLOWER);

			task = get_local_entity_parent (guide, LIST_TYPE_GUIDE);

			if (task)
			{
				debug_log ("EV_DEBUG: Aborting Task %s", get_local_entity_string (task, STRING_TYPE_FULL_NAME));

				notify_local_entity (ENTITY_MESSAGE_TASK_COMPLETED, task, task, TASK_TERMINATED_ABORTED);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_entity_primary_task_abort (event *ev)
{
	entity
		*en,
		*task;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if (en)
		{
			task = get_local_entity_primary_task (en);

			if (task)
			{
				debug_log ("EV_DEBUG: Aborting Task %s", get_local_entity_string (task, STRING_TYPE_FULL_NAME));

				notify_local_entity (ENTITY_MESSAGE_TASK_COMPLETED, task, task, TASK_TERMINATED_ABORTED);
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_capture_keysite_event (event *ev)
{
	entity
		*en,
		*group,
		*keysite;

	int
		side,
		new_side;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if (en)
		{
			group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

			if (group)
			{
				keysite = get_local_entity_parent (group, LIST_TYPE_KEYSITE_GROUP);

				if (keysite)
				{
					if (get_local_entity_type (keysite) == ENTITY_TYPE_KEYSITE)
					{
						side = get_local_entity_int_value (keysite, INT_TYPE_SIDE);

						new_side = get_enemy_side (side);

						capture_keysite (keysite, (entity_sides) new_side);
					}
				}
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_create_troop_insert_event (event *ev)
{
	entity
		*en,
		*group,
		*keysite,
		*new_task;

	int
		sub_type,
		side,
		new_side;

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		en = get_external_view_entity ();

		if (en)
		{
			group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

			if (group)
			{
				keysite = get_local_entity_parent (group, LIST_TYPE_KEYSITE_GROUP);

				if (keysite)
				{
					if (get_local_entity_type (keysite) == ENTITY_TYPE_KEYSITE)
					{
						sub_type = get_local_entity_int_value (keysite, INT_TYPE_ENTITY_SUB_TYPE);

						if (keysite_database [sub_type].troop_insertion_target)
						{
							side = get_local_entity_int_value (keysite, INT_TYPE_SIDE);

							new_side = get_enemy_side (side);

							if (!entity_is_object_of_task (keysite, ENTITY_SUB_TYPE_TASK_TROOP_INSERTION, (entity_sides) new_side))
							{
								new_task = create_troop_insertion_task ((entity_sides) new_side, keysite, NULL, TRUE, 10, NULL, NULL);

								debug_log ("EV_DEBUG: Created TROOP INSERTION (%d) to %s",
											get_local_entity_safe_index (new_task),
											get_local_entity_string (keysite, STRING_TYPE_KEYSITE_NAME));
							}
						}
					}
				}
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_set_current_language (event *ev)
{
	ASSERT (ev);

	switch (ev->key)
	{
		case DIK_1:
		{
			set_global_current_language (LANGUAGE_ENGLISH);

			break;
		}
		case DIK_2:
		{
			set_global_current_language (LANGUAGE_FRENCH);

			break;
		}
		case DIK_3:
		{
			set_global_current_language (LANGUAGE_GERMAN);

			break;
		}
		case DIK_4:
		{
			set_global_current_language (LANGUAGE_ITALIAN);

			break;
		}
		case DIK_5:
		{
			set_global_current_language (LANGUAGE_SPANISH);

			break;
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void debug_set_entity_group_formation (event *ev)
{
	entity
		*en,
		*group;

	ASSERT (ev);

	en = get_external_view_entity ();

	if (en)
	{
		group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

		if (group)
		{
			switch (ev->key)
			{
				case DIK_1:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_ROW_LEFT);

					break;
				}
				case DIK_2:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_ROW_RIGHT);

					break;
				}
				case DIK_3:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_ECHELON_LEFT);

					break;
				}
				case DIK_4:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_ECHELON_RIGHT);

					break;
				}
				case DIK_5:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_COLUMN);

					break;
				}
				case DIK_6:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_WEDGE);

					break;
                }
//VJ 060306 for Maverick 3 new group formations
				case DIK_7:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_DIAMOND);

					break;
                 }
				case DIK_8:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_STAGGERED_TRAIL_LEFT);

					break;
                }
				case DIK_9:
				{
					set_client_server_entity_int_value (group, INT_TYPE_GROUP_FORMATION, FORMATION_STAGGERED_TRAIL_RIGHT);

					break;

				}
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void set_external_view_entity_next_waypoint (event *ev)
{
	entity
		*en,
		*guide;

	en = get_external_view_entity ();

	if (en)
	{
		guide = get_local_entity_parent (en, LIST_TYPE_FOLLOWER);

		if (guide)
		{
			set_guide_next_waypoint (guide);
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void output_influence_maps_event (event *ev)
{
	output_all_influence_maps ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void eject_external_view_entity_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		initiate_aircraft_crew_ejection (en);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void uneject_external_view_entity_event (event *ev)
{
	entity
		*en;

	if (in_cockpit)
	{
		en = get_gunship_entity ();
	}
	else
	{
		en = get_external_view_entity ();
	}

	if (en)
	{
		uneject_aircraft_crew (en);
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void dump_aircraft_and_vehicle_count_event (event *ev)
{
	dump_aircraft_and_vehicle_count ();
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void create_debug_advance_task (event *ev)
{
	entity
		*en,
		*group;

	entity_sub_types
		sub_type;

	entity_sides
		side;

	unsigned int
		node;

	int
		from_node,
		to_node;

	vec3d
		*node_pos;

	en = get_external_view_entity ();

	if (en)
	{
		group = get_local_entity_parent (en, LIST_TYPE_MEMBER);

		if (group)
		{
			sub_type = get_local_entity_int_value (group, INT_TYPE_ENTITY_SUB_TYPE);

			if (group_database [sub_type].frontline_flag)
			{
				if (get_local_entity_int_value (group, INT_TYPE_ALIVE))
				{
					if ((get_local_entity_int_value (group, INT_TYPE_GROUP_MODE) != GROUP_MODE_BUSY) && (check_group_members_awake (group)))
					{
						from_node = get_local_entity_int_value (group, INT_TYPE_ROUTE_NODE);

						side = (entity_sides) get_local_entity_int_value (group, INT_TYPE_SIDE);

						for (node = 0; node < road_nodes [from_node].number_of_links; node ++)
						{
							to_node = road_nodes [from_node].links [node].node;

							if (to_node != from_node)
							{
								if (road_nodes [to_node].side_occupying != side)
								{
									if (get_road_link_breaks (from_node, to_node) == 0)
									{
										node_pos = &road_node_positions [to_node];

										if (point_inside_adjusted_map_area (node_pos))
										{
											if (notify_local_entity (ENTITY_MESSAGE_GROUND_FORCE_ADVANCE, group, NULL, to_node))
											{
												break;
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// MISCELLANEOUS EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void demo_shortcut_event (event *ev)
{
	ASSERT (get_session_entity ());

	if (get_comms_model () == COMMS_MODEL_SERVER)
	{
		set_client_server_entity_float_value (get_session_entity (), FLOAT_TYPE_TIME_OF_DAY_ACCELERATION, 60.0 * 10.0);

		set_client_server_entity_int_value (get_session_entity (), INT_TYPE_SKIP_NIGHT_TIME, TRUE);

		set_client_server_entity_int_value (get_session_entity (), INT_TYPE_INFINITE_WEAPONS, TRUE);
	}

	notify_local_entity (ENTITY_MESSAGE_SET_CAMERA_ACTION, get_camera_entity (), NULL, CAMERA_ACTION_AUTO_EDIT);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void reset_cpu_info (event *ev)
{
	cpu_count_av = 0.0;

	cpu_count_av_percent = 0.0;

	cpu_count_max = 0.0;
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//
// SET EVENTS
//
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void set_ui_debug_events (void)
{
	set_event (DIK_S, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, save_ui_screen);

	set_event (DIK_Z, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, save_ui_screen);

	////////////////////////////////////////
	// 				LANGUAGES				  //
	////////////////////////////////////////

	set_event (DIK_1, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_2, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_3, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_4, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_5, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);
}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void set_flight_debug_events (void)
{
	/////////////////////////////////////////////////////////////////////////
	//
	// KEYBOARD EVENTS
	//
	/////////////////////////////////////////////////////////////////////////

	set_event (DIK_1, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	set_event (DIK_2, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	set_event (DIK_3, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	set_event (DIK_4, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	set_event (DIK_5, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	set_event (DIK_6, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_set_entity_group_formation);

	////////////////////////////////////////
	// 				LANGUAGES				  //
	////////////////////////////////////////

	set_event (DIK_1, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_2, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_3, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_4, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	set_event (DIK_5, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_set_current_language);

	////////////////////////////////////////

	set_event (DIK_A, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_entity_task_abort);

	set_event (DIK_A, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_articulation_test_event);

	set_event (DIK_A, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_suppress_ai_fire_event);

	////////////////////////////////////////

	set_event (DIK_B, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, heavy_damage_gunship_event);

	set_event (DIK_B, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, medium_damage_gunship_event);

	set_event (DIK_B, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_draw_collision_boxes_event);

	////////////////////////////////////////

	set_event (DIK_C, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, launch_chaff_event);

	set_event (DIK_C, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_test_cockpit_instruments_event);

	set_event (DIK_C, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_virtual_cockpit_needles_event);

	////////////////////////////////////////

	set_event (DIK_D, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, demo_shortcut_event);

	set_event (DIK_D, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_external_view_entity_debug_task_info_event);

	set_event (DIK_D, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_in_flight_external_view_entity_debug_flight_info_event);

	////////////////////////////////////////

	set_event (DIK_E, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, cycle_cpg_assistance_event);

	set_event (DIK_E, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, create_ground_engage_task_event);

	set_event (DIK_E, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, create_air_engage_task_event);

	////////////////////////////////////////

	set_event (DIK_F, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, launch_flare_event);

	set_event (DIK_F, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_infinite_weapons_event);

	set_event (DIK_F, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_in_flight_debug_force_info_event);

	////////////////////////////////////////

	set_event (DIK_G, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, launch_smoke_grenade_event);

	set_event (DIK_G, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, clear_debug_3d_graphics_event);

	set_event (DIK_G, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_infinite_fuel_event);

	////////////////////////////////////////

	set_event (DIK_H, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_hud_layout_grid_event);

	set_event (DIK_H, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, damage_external_view_entity_event);

	set_event (DIK_H, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, create_debug_advance_task);

	////////////////////////////////////////

	set_event (DIK_I, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, toggle_ai_invulnerable_event);

	set_event (DIK_I, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_debug_misc_info_event);

	set_event (DIK_I, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_invulnerable_event);

	////////////////////////////////////////

	set_event (DIK_J, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_capture_keysite_event);

	set_event (DIK_J, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, eject_external_view_entity_event);

	set_event (DIK_J, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, output_influence_maps_event);

	////////////////////////////////////////

//	set_event (DIK_K, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, assess_external_view_entity_weapon_effectiveness_event);

	set_event (DIK_K, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_debug_keysite_info_event);

	set_event (DIK_K, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, kill_external_view_entity_event);

	////////////////////////////////////////

	set_event (DIK_L, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, set_entity_group_leader_event);

	set_event (DIK_L, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_local_weather_model_event);

	set_event (DIK_L, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_in_flight_gunship_target_list_info_event);

	////////////////////////////////////////

	set_event (DIK_M, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, restore_external_view_entity_main_rotors_event);

	set_event (DIK_M, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_mfd_layout_grid_event);

	set_event (DIK_M, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, damage_external_view_entity_main_rotors_event);

	////////////////////////////////////////

	set_event (DIK_N, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_night_vision_system_active_event);

	set_event (DIK_N, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, set_external_view_entity_next_waypoint);

	////////////////////////////////////////

	set_event (DIK_O, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, launch_crate_event);

	set_event (DIK_O, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, dump_aircraft_and_vehicle_count_event);

	////////////////////////////////////////

	set_event (DIK_P, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, debug_entity_primary_task_abort);

	////////////////////////////////////////

	set_event (DIK_R, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, toggle_record_screen_sequence_event);

	////////////////////////////////////////

	set_event (DIK_S, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, save_screen_image_event);

	set_event (DIK_S, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, save_hires_screen_image_event);

	set_event (DIK_S, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, delete_screen_image_event);

	////////////////////////////////////////

	set_event (DIK_T, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, increase_session_time_of_day_acceleration);

	set_event (DIK_T, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, reset_session_time_of_day_acceleration);

	set_event (DIK_T, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, set_demo_time_of_day_acceleration);

	////////////////////////////////////////

	set_event (DIK_U, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, uneject_external_view_entity_event);

	set_event (DIK_U, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, set_gunship_entity_to_null_event);

	set_event (DIK_U, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_create_troop_insert_event);

	////////////////////////////////////////

	set_event (DIK_V, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, fully_repair_gunship_damage_event);

	set_event (DIK_V, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, partially_repair_gunship_damage_event);

	set_event (DIK_V, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, transmit_external_view_entity_event);

	////////////////////////////////////////

	set_event (DIK_W, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, set_fine_weather_mode_event);

	set_event (DIK_W, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_external_view_entity_weapon_info_event);

	set_event (DIK_W, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, cycle_weather_modes_event);

	////////////////////////////////////////

	set_event (DIK_Y, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_in_flight_external_view_entity_guide_info_event);

	set_event (DIK_Y, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, create_dummy_task_event);

	////////////////////////////////////////

	set_event (DIK_Z, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_in_flight_zoom_test_event);

	set_event (DIK_Z, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_simple_avionics_event);

	////////////////////////////////////////

	set_event (DIK_SPACE, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, launch_weapon_event);

	set_event (DIK_SPACE, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, launch_persuer_weapon_event);

	////////////////////////////////////////

	set_event (DIK_0, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, reset_cpu_info);

	////////////////////////////////////////

	set_event (DIK_F1, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, safe_view_event);

	////////////////////////////////////////

	set_event (DIK_F2, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_draw_collision_boxes_event);

	set_event (DIK_F2, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, toggle_draw_collision_box_lifetime_event);

	////////////////////////////////////////

	set_event (DIK_F3, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_draw_radar_sweep_event);

	////////////////////////////////////////

	set_event (DIK_F4, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_draw_radar_terrain_los_markers_event);

	////////////////////////////////////////

	set_event (DIK_F5, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, toggle_gunship_object_event);

	set_event (DIK_F5, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debriefing_event);

	////////////////////////////////////////

	set_event (DIK_F6, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, view_wingmen_event);

	////////////////////////////////////////

	set_event (DIK_F9, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, set_hires_screen_image_view_angle_1_event);

	set_event (DIK_F9, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, recognition_guide_top_view_event);

	////////////////////////////////////////

	set_event (DIK_F10, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, set_hires_screen_image_view_angle_2_event);

	set_event (DIK_F10, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, recognition_guide_side_view_event);

	////////////////////////////////////////

	set_event (DIK_F11, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, set_hires_screen_image_view_angle_3_event);

	set_event (DIK_F11, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, recognition_guide_front_view_event);

	////////////////////////////////////////

	set_event (DIK_F12, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, set_hires_screen_image_view_angle_4_event);

	set_event (DIK_F12, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, recognition_guide_3d_view_event);

	////////////////////////////////////////

	set_event (DIK_BACKSPACE, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, select_previous_weapon_event);

	set_event (DIK_BACKSPACE, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, select_next_weapon_event);

	set_event (DIK_BACKSPACE, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, select_invalid_weapon_event);

	////////////////////////////////////////

	set_event (DIK_EQUALS, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, reload_weapon_config_event);

	set_event (DIK_EQUALS, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, select_next_weapon_config_event);

	set_event (DIK_EQUALS, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, increase_drag_z_event);

	////////////////////////////////////////

	set_event (DIK_MINUS, MODIFIER_RIGHT_SHIFT, KEY_STATE_DOWN, unarm_weapon_config_event);

	set_event (DIK_MINUS, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, select_previous_weapon_config_event);

	set_event (DIK_MINUS, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, decrease_drag_z_event);

	set_event (DIK_NUMPAD0, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD0, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD1, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD1, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD2, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD2, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD3, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD3, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD4, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD4, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD5, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD5, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD6, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD6, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD7, MODIFIER_RIGHT_ALT, KEY_STATE_DOWN, debug_adjust_damper_stiffness);
	set_event (DIK_NUMPAD7, MODIFIER_RIGHT_CONTROL, KEY_STATE_DOWN, debug_adjust_damper_stiffness);

}

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
